// Вызов команды перерасчета цен в табличной части
&НаКлиенте
Процедура СделатьПерерасчётЦеныПоВалюте(Команда)
	
	Если Объект.КурсВалюты = 0 Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Курс валюты не может быть 0!";
		Сообщение.Сообщить();
		
		Возврат;
	КонецЕсли;
	
	Для каждого СтрТЧ Из Объект.СписокНоменклатуры Цикл
		СтрТЧ.Цена = СтрТЧ.Цена / Объект.КурсВалюты;
		
		Если СтрТЧ.Количество = 0 Тогда
			Продолжить;
		Иначе
			СтрТЧ.Всего = СтрТЧ.Цена * СтрТЧ.Количество;	
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Получение курса выбранной валюты из регистра сведений
&НаСервере
Процедура СделатьПерерасчётЦеныПоВалютеНаСервере()
	
	ВалютаОтбор = Новый Структура("Валюта", Объект.Валюта);
	Курс = РегистрыСведений.КурсыВалют.Получить(Объект.Дата, ВалютаОтбор).Курс;
	
	Если Курс = Неопределено Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Не указан курс валют на " + Объект.Дата;
		Сообщение.Сообщить();
	Иначе
		Объект.КурсВалюты = Курс;
	КонецЕсли;
		
КонецПроцедуры

// При изменении выбранной валюты получим ее курс с сервера
&НаКлиенте
Процедура ВалютаПриИзменении(Элемент)
	СделатьПерерасчётЦеныПоВалютеНаСервере();
КонецПроцедуры

// Перерасчет итога 
&НаКлиенте
Процедура СписокНоменклатурыКоличествоПриИзменении(Элемент)
	
	СтрТЧ = Элементы.СписокНоменклатуры.ТекущиеДанные;
	СтрТЧ.Всего = СтрТЧ.Цена * СтрТЧ.Количество;
	
КонецПроцедуры

// Перерасчет итога
&НаКлиенте
Процедура СписокНоменклатурыЦенаПриИзменении(Элемент)
	
	СтрТЧ = Элементы.СписокНоменклатуры.ТекущиеДанные;
	СтрТЧ.Всего = СтрТЧ.Цена * СтрТЧ.Количество;

КонецПроцедуры

