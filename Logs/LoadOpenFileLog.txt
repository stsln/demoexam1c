// Форма элемента справочника Изделие

&НаСервере
Процедура ЗагрузитьФайлНаСервер(Результат, ДопПараметр) Экспорт
	// Если файл выбран, то получим его ссылку
	Если НЕ(Результат = Неопределено) Тогда
		СсылкаНаФайл = Результат[0];
	// Иначе возврат
	Иначе
		Сообщить("Файл не выбран");
		Возврат;		
	КонецЕсли;
	// Получим разрешение и название файла
	ПозицияПоследнейТочки = СтрНайти(СсылкаНаФайл, ".", НаправлениеПоиска.СКонца, , 1);
	ПозицияПоследнегоСлеша = СтрНайти(СсылкаНаФайл, "\", НаправлениеПоиска.СКонца, , 1);
	РасширениефайлаИзДиалога = Прав(СсылкаНаФайл, СтрДлина(СсылкаНаФайл) - ПозицияПоследнейТочки);
	ИмяФайлаДиалог = Сред(СсылкаНаФайл, ПозицияПоследнегоСлеша + 1, ПозицияПоследнейТочки - ПозицияПоследнегоСлеша - 1);
	// Сохраним файл в 1с
	ДокументОбъект = РеквизитФормыВЗначение("Объект");
	ДанныеФайла = Новый ДвоичныеДанные(СсылкаНаФайл);
	КоличествоСтрок = ДокументОбъект.Документация.Количество();
	ДокументОбъект.Документация.Добавить();
	ДокументОбъект.Документация[КоличествоСтрок].Файл = Новый ХранилищеЗначения(ДанныеФайла, Новый СжатиеДанных(9));
	ДокументОбъект.Документация[КоличествоСтрок].ИмяФайла = ИмяФайлаДиалог;
	ДокументОбъект.Документация[КоличествоСтрок].РасширениеФайла = РасширениеФайлаИзДиалога;
	ДокументОбъект.Записать();
	Элементы.ДокументацияЗагрузитьФайл.Доступность = Истина;
	ЗначениеВРеквизитФормы(ДокументОбъект, "Объект");
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьФайл(Команда)	
	ВыборФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ВыборФайла.МножественныйВыбор = Ложь;
	// Выведем диалог выбора файла и передадим его путь в процедуру на сервере
	ВыборФайла.Показать(Новый ОписаниеОповещения("ЗагрузитьФайлНаСервер", ЭтаФорма, Новый Структура)); 
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	// Если нет файлов, то запретим открытие файлов 
	Если Объект.Документация.Количество() > 0 Тогда
		Элементы.ДокументацияОткрытьФайл.Доступность = Истина;
	// Иначе - разрешим
	Иначе
		Элементы.ДокументацияОткрытьФайл.Доступность = Ложь;
	КонецЕсли;
КонецПроцедуры


&НаСервере
Процедура ОткрытьФайлССервера(НомерСтроки)
	// Откроем файл из выбранной строки
	ДокументОбъект = Реквизитформывзначение("Объект");
	Путь = ПолучитьИмяВременногоФайла(ДокументОбъект.Документация[НомерСтроки - 1].РасширениеФайла);
	Данные = ДокументОбъект.Документация[НомерСтроки - 1].Файл.Получить();
	Данные.Записать(Путь);
	ЗапуститьПриложение(Путь);
	ЗначениеВРеквизитФормы(ДокументОбъект, "Объект");
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФайл(Команда)	
	НомерТекущейСтроки = Элементы.Документация.ТекущиеДанные.НомерСтроки;
	// Передадим процедуре на сервере выбранную строку
	ОткрытьФайлССервера(НомерТекущейСтроки);
КонецПроцедуры