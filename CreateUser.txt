&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	// Сначала проверим нет ли пользователя с новым логином
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	Пользователи.Логин КАК Логин,
	|	Пользователи.УникальныйИдентификатор КАК УникальныйИдентификатор
	|ИЗ
	|	Справочник.Пользователи КАК Пользователи
	|ГДЕ
	|	(Пользователи.Логин = &Логин
	|			ИЛИ Пользователи.УникальныйИдентификатор = &УникальныйИдентификатор)";
	Запрос.УстановитьПараметр("Логин", Объект.Логин);
	Запрос.УстановитьПараметр("УникальныйИдентификатор", Объект.УникальныйИдентификатор);
	Результат = Запрос.Выполнить().Выбрать();
	// Если пользователь обнаружен, то отказ создания нового пользователя
	Если Результат.Следующий() Тогда 	
		Сообщение = Новый СообщениеПользователю;
		Если Результат.УникальныйИдентификатор = Объект.УникальныйИдентификатор Тогда 
			Сообщение.Текст = "Созданного пользователя нельзя изменить!";    			
		Иначе
			Сообщение.Текст = "Пользователь с таким логином уже существует!"; 	
		КонецЕсли;
	    Сообщение.Сообщить();
		Отказ = Истина;
	//Иначе создадим новую запись
	Иначе
		НовыйПользователь = ПользователиИнформационнойБазы.СоздатьПользователя();
		НовыйПользователь.Имя = Объект.Логин;
		НовыйПользователь.Пароль = Объект.Пароль;
		НовыйПользователь.ПолноеИмя = Объект.Наименование;
		Если Объект.Роль = Перечисления.Роли.Администратор Тогда
			НовыйПользователь.Роли.Добавить(Метаданные.Роли.Администратор);
		ИначеЕсли Объект.Роль = Перечисления.Роли.МенеджерПоЗакупкам Тогда
			НовыйПользователь.Роли.Добавить(Метаданные.Роли.МенеджерПоЗакупкам);
		ИначеЕсли Объект.Роль = Перечисления.Роли.МенеджерПоПродажам Тогда
			НовыйПользователь.Роли.Добавить(Метаданные.Роли.МенеджерПоПродажам);
		ИначеЕсли Объект.Роль = Перечисления.Роли.Мастер Тогда
			НовыйПользователь.Роли.Добавить(Метаданные.Роли.Мастер);
		КонецЕсли; 
		НовыйПользователь.Записать();
		ТекущийОбъект.УникальныйИдентификатор = НовыйПользователь.УникальныйИдентификатор;
	КонецЕсли;	
КонецПроцедуры;